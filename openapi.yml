openapi: 3.0.0
info:
  title: Billiard-diary-backend API
  version: 1.0.0

paths:
  /positions:
    post:
      tags: [Positions]
      summary: Создать позицию
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Position"
      responses:
        "201":
          description: Position created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean, example: true }
                  id: { type: integer }
        "500":
          description: Database error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    get:
      tags: [Positions]
      summary: Получение всех позиций
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean, example: true }
                  positions:
                    type: array
                    items:
                      $ref: "#/components/schemas/Position"
        "500":
          description: Database error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /positions/{id}:
    get:
      tags: [Positions]
      summary: Получить позицию по id
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean, example: true }
                  position:
                    $ref: "#/components/schemas/Position"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Database error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    put:
      tags: [Positions]
      summary: Обновление позиции
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Position"
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean, example: true }
                  id: { type: integer }
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Database error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      tags: [Positions]
      summary: Удаление позиции
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        "204":
          description: Success (no content)
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Database error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    Position:
      type: object
      required:
        - layout
        - power
      additionalProperties: false
      properties:
        id:
          type: integer
          readOnly: true
        layout:
          type: object
          required:
            - balls
          additionalProperties: false
          properties:
            spin:
              type: object
              required: [x, y]
              additionalProperties: false
              properties:
                x: { type: number }
                y: { type: number }
            balls:
              type: array
              items:
                type: object
                required: [x, y]
                additionalProperties: false
                properties:
                  x: { type: number }
                  y: { type: number }
                  type: { type: string }
            lines:
              type: array
              items:
                type: object
                required: [from, to]
                additionalProperties: false
                properties:
                  from:
                    type: object
                    required: [x, y]
                    additionalProperties: false
                    properties:
                      x: { type: number }
                      y: { type: number }
                  to:
                    type: object
                    required: [x, y]
                    additionalProperties: false
                    properties:
                      x: { type: number }
                      y: { type: number }
                  type: { type: string }
        power:
          type: number
        created_at:
          type: string
          format: date-time
          readOnly: true
        updated_at:
          type: string
          format: date-time
          readOnly: true

    Error:
      type: object
      required:
        - ok
        - error
      properties:
        ok:
          type: boolean
          enum: [false]
          example: false
        error:
          type: string
          example: "db error"
